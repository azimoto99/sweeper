import { vi } from 'vitest'

// Mock mapbox-gl
vi.mock('mapbox-gl', () => ({
  default: {
    Map: vi.fn(() => ({
      addControl: vi.fn(),
      addSource: vi.fn(),
      addLayer: vi.fn(),
      removeLayer: vi.fn(),
      removeSource: vi.fn(),
      setCenter: vi.fn(),
      setZoom: vi.fn(),
      fitBounds: vi.fn(),
      flyTo: vi.fn(),
      on: vi.fn(),
      off: vi.fn(),
      remove: vi.fn(),
      resize: vi.fn(),
      getCanvas: vi.fn(() => ({
        style: { cursor: 'default' },
      })),
      getCenter: vi.fn(() => ({ lng: 0, lat: 0 })),
      getZoom: vi.fn(() => 10),
      getBounds: vi.fn(() => ({
        getNorthEast: vi.fn(() => ({ lng: 1, lat: 1 })),
        getSouthWest: vi.fn(() => ({ lng: -1, lat: -1 })),
      })),
      project: vi.fn(() => ({ x: 0, y: 0 })),
      unproject: vi.fn(() => ({ lng: 0, lat: 0 })),
      queryRenderedFeatures: vi.fn(() => []),
      querySourceFeatures: vi.fn(() => []),
      isSourceLoaded: vi.fn(() => true),
      getSource: vi.fn(),
      getLayer: vi.fn(),
      setPaintProperty: vi.fn(),
      setLayoutProperty: vi.fn(),
      setFilter: vi.fn(),
      setPadding: vi.fn(),
      easeTo: vi.fn(),
      stop: vi.fn(),
      isMoving: vi.fn(() => false),
      isZooming: vi.fn(() => false),
      isRotating: vi.fn(() => false),
      loaded: vi.fn(() => true),
      getBearing: vi.fn(() => 0),
      setBearing: vi.fn(),
      getPitch: vi.fn(() => 0),
      setPitch: vi.fn(),
      cameraForBounds: vi.fn(),
      setMaxBounds: vi.fn(),
      setMinZoom: vi.fn(),
      setMaxZoom: vi.fn(),
      setStyle: vi.fn(),
      getStyle: vi.fn(),
      isStyleLoaded: vi.fn(() => true),
      areTilesLoaded: vi.fn(() => true),
      showTileBoundaries: false,
      showCollisionBoxes: false,
      showOverdrawInspector: false,
      repaint: false,
      getContainer: vi.fn(() => document.createElement('div')),
      getCanvasContainer: vi.fn(() => document.createElement('div')),
      version: '2.0.0',
    })),
    Marker: vi.fn(() => ({
      setLngLat: vi.fn().mockReturnThis(),
      addTo: vi.fn().mockReturnThis(),
      remove: vi.fn().mockReturnThis(),
      setPopup: vi.fn().mockReturnThis(),
      getPopup: vi.fn(),
      togglePopup: vi.fn().mockReturnThis(),
      setOffset: vi.fn().mockReturnThis(),
      setDraggable: vi.fn().mockReturnThis(),
      isDraggable: vi.fn(() => false),
      setRotation: vi.fn().mockReturnThis(),
      getRotation: vi.fn(() => 0),
      setRotationAlignment: vi.fn().mockReturnThis(),
      getRotationAlignment: vi.fn(() => 'auto'),
      setPitchAlignment: vi.fn().mockReturnThis(),
      getPitchAlignment: vi.fn(() => 'auto'),
      getElement: vi.fn(() => document.createElement('div')),
      getLngLat: vi.fn(() => ({ lng: 0, lat: 0 })),
      on: vi.fn().mockReturnThis(),
      off: vi.fn().mockReturnThis(),
    })),
    Popup: vi.fn(() => ({
      setLngLat: vi.fn().mockReturnThis(),
      setText: vi.fn().mockReturnThis(),
      setHTML: vi.fn().mockReturnThis(),
      setDOMContent: vi.fn().mockReturnThis(),
      addTo: vi.fn().mockReturnThis(),
      remove: vi.fn().mockReturnThis(),
      isOpen: vi.fn(() => false),
      getLngLat: vi.fn(() => ({ lng: 0, lat: 0 })),
      setOffset: vi.fn().mockReturnThis(),
      setMaxWidth: vi.fn().mockReturnThis(),
      setClassName: vi.fn().mockReturnThis(),
      toggleClassName: vi.fn().mockReturnThis(),
      on: vi.fn().mockReturnThis(),
      off: vi.fn().mockReturnThis(),
    })),
    NavigationControl: vi.fn(() => ({
      onAdd: vi.fn(),
      onRemove: vi.fn(),
    })),
    GeolocateControl: vi.fn(() => ({
      onAdd: vi.fn(),
      onRemove: vi.fn(),
      trigger: vi.fn(),
    })),
    ScaleControl: vi.fn(() => ({
      onAdd: vi.fn(),
      onRemove: vi.fn(),
    })),
    FullscreenControl: vi.fn(() => ({
      onAdd: vi.fn(),
      onRemove: vi.fn(),
    })),
    AttributionControl: vi.fn(() => ({
      onAdd: vi.fn(),
      onRemove: vi.fn(),
    })),
    LngLatBounds: vi.fn(() => ({
      extend: vi.fn().mockReturnThis(),
      getCenter: vi.fn(() => ({ lng: 0, lat: 0 })),
      getSouthWest: vi.fn(() => ({ lng: -1, lat: -1 })),
      getNorthEast: vi.fn(() => ({ lng: 1, lat: 1 })),
      getNorthWest: vi.fn(() => ({ lng: -1, lat: 1 })),
      getSouthEast: vi.fn(() => ({ lng: 1, lat: -1 })),
      getWest: vi.fn(() => -1),
      getSouth: vi.fn(() => -1),
      getEast: vi.fn(() => 1),
      getNorth: vi.fn(() => 1),
      toArray: vi.fn(() => [[-1, -1], [1, 1]]),
      toString: vi.fn(() => 'LngLatBounds(-1, -1, 1, 1)'),
      isEmpty: vi.fn(() => false),
      contains: vi.fn(() => true),
    })),
    LngLat: vi.fn(() => ({
      lng: 0,
      lat: 0,
      wrap: vi.fn().mockReturnThis(),
      toArray: vi.fn(() => [0, 0]),
      toString: vi.fn(() => 'LngLat(0, 0)'),
      distanceTo: vi.fn(() => 0),
      toBounds: vi.fn(),
    })),
    setRTLTextPlugin: vi.fn(),
    getRTLTextPluginStatus: vi.fn(() => 'unavailable'),
    prewarm: vi.fn(),
    clearPrewarmedResources: vi.fn(),
    accessToken: 'test-token',
    version: '2.0.0',
    supported: vi.fn(() => true),
    workerCount: 4,
    maxParallelImageRequests: 16,
  },
}))

// Mock the mapbox lib
vi.mock('../../lib/mapbox', () => ({
  initializeMap: vi.fn(),
  geocodeAddress: vi.fn(),
  reverseGeocode: vi.fn(),
  calculateDistance: vi.fn(),
  isWithinServiceArea: vi.fn(),
  createMarker: vi.fn(),
  updateMarkerPosition: vi.fn(),
  drawRoute: vi.fn(),
  clearRoute: vi.fn(),
  fitBoundsToPoints: vi.fn(),
  addGeofence: vi.fn(),
  removeGeofence: vi.fn(),
  SERVICE_AREA_CENTER: { lng: -99.4803, lat: 27.5306 },
  SERVICE_AREA_RADIUS: 25,
}))